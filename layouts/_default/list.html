{{- define "main" }}

{{- if (and site.Params.profileMode.enabled .IsHome) }}
{{- partial "index_profile.html" . }}
{{- else }}

{{- if not .IsHome | and .Title }}
<header class="page-header" role="banner">
  {{- partial "breadcrumbs.html" . }}
  <h1 id="page-title">{{ .Title }}</h1>
  {{- if .Description }}
  <div class="post-description">
    {{ .Description | markdownify }}
  </div>
  {{- end }}
</header>
{{- end }}

{{- if .Content }}
<section class="post-content" role="region" aria-labelledby="page-title">
  {{- if not (.Param "disableAnchoredHeadings") }}
  {{- partial "anchored_headings.html" .Content -}}
  {{- else }}{{ .Content }}{{ end }}
</section>
{{- end }}

{{- $pages := union .RegularPages .Sections }}

{{- if .IsHome }}
{{- $pages = where site.RegularPages "Type" "in" site.Params.mainSections }}
{{- $pages = where $pages "Params.hiddenInHomeList" "!=" "true" }}
{{- end }}

{{- $paginator := .Paginate $pages }}

{{- if and .IsHome site.Params.homeInfoParams (eq $paginator.PageNumber 1) }}
<section class="hero-section" role="banner" aria-label="Website introduction">
  <div class="hero-content">
    <h1 id="site-title">{{ site.Params.homeInfoParams.Title }}</h1>
    <p class="hero-description">{{ site.Params.homeInfoParams.Content }}</p>
    <div class="hero-stats">
      <div class="stat">
        <span class="stat-number">{{ len (where site.RegularPages "Type" "posts") }}+</span>
        <span class="stat-label">Expert Reviews</span>
      </div>
      <div class="stat">
        <span class="stat-number">50+</span>
        <span class="stat-label">Tested Products</span>
      </div>
      <div class="stat">
        <span class="stat-number">100%</span>
        <span class="stat-label">Honest Reviews</span>
      </div>
    </div>
  </div>
</div>

<div class="categories-section">
  <h2>Shop by Category</h2>
  <div class="categories-grid">
    <div class="category-card" data-filter="dog">
      <div class="category-icon">üêï</div>
      <h3>Dog Products</h3>
      <p>Food, toys, beds & more</p>
    </div>
    <div class="category-card" data-filter="cat">
      <div class="category-icon">üê±</div>
      <h3>Cat Essentials</h3>
      <p>Litter, scratching posts & treats</p>
    </div>
    <div class="category-card" data-filter="health">
      <div class="category-icon">üíä</div>
      <h3>Health & Wellness</h3>
      <p>Supplements & dental care</p>
    </div>
    <div class="category-card" data-filter="all">
      <div class="category-icon">üèÉ</div>
      <h3>All Products</h3>
      <p>View all reviews & guides</p>
    </div>
  </div>
</div>
{{- end }}

{{- if $paginator.Pages }}
{{- if .IsHome }}
<div class="featured-posts-section">
  <h2>Latest Reviews & Guides</h2>
  <p>Our most recent expert reviews and buying guides to help you make the best choices for your pets.</p>
</div>
{{- end }}
<div class="posts-container">
  <div class="posts-grid">
    {{- range $paginator.Pages }}
  {{- $category := "all" }}
  {{- $tags := .Params.tags | default slice }}
  {{- $tagsString := delimit $tags " " }}
  {{- if or (in .Title "Dog") (in .Title "dog") (in $tagsString "dog") }}
    {{- $category = "dog" }}
  {{- else if or (in .Title "Cat") (in .Title "cat") (in $tagsString "cat") }}
    {{- $category = "cat" }}
  {{- else if or (in .Title "Health") (in .Title "health") (in .Title "Dental") (in .Title "dental") (in $tagsString "health") (in $tagsString "dental") }}
    {{- $category = "health" }}
  {{- end }}
  <article class="post-card" data-category="{{ $category }}">
    <div class="post-card-content">
      <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
      <p>{{ .Summary }}</p>
      <div class="post-meta">
        <span>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1H2z"/>
            <path d="M14 5H2v9a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V5z"/>
          </svg>
          {{ .Date.Format "January 2, 2006" }}
        </span>
        <span>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 4.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3a.5.5 0 0 1 1 0z"/>
          </svg>
          {{ .ReadingTime }} min read
        </span>
        {{- if .Params.tags }}
        <span>{{ len .Params.tags }} tags</span>
        {{- end }}
      </div>
    </div>
  </article>
    {{- end }}
  </div>
</div>
{{- end }}

{{/* Pagination - Completely separate from posts grid */}}
{{- if and $paginator.Pages (gt $paginator.TotalPages 1) }}
<nav class="pagination" role="navigation" aria-label="pagination">
  {{- if $paginator.HasPrev }}
  <a href="{{ $paginator.Prev.URL }}" class="btn" rel="prev" aria-label="Previous page">‚Üê Previous</a>
  {{- end }}
  {{- if $paginator.HasNext }}
  <a href="{{ $paginator.Next.URL }}" class="btn" rel="next" aria-label="Next page">Next ‚Üí</a>
  {{- end }}
</nav>
{{- end }}

{{- end }}

{{- if .IsHome }}
<script src="/js/category-filter.js"></script>
{{- end }}

{{- end }}
