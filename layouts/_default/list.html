{{- define "main" }}

{{- if (and site.Params.profileMode.enabled .IsHome) }}
{{- partial "index_profile.html" . }}
{{- else }}

{{- if not .IsHome | and .Title }}
<header class="page-header">
  {{- partial "breadcrumbs.html" . }}
  <h1>{{ .Title }}</h1>
  {{- if .Description }}
  <div class="post-description">
    {{ .Description | markdownify }}
  </div>
  {{- end }}
</header>
{{- end }}

{{- if .Content }}
<div class="post-content">
  {{- if not (.Param "disableAnchoredHeadings") }}
  {{- partial "anchored_headings.html" .Content -}}
  {{- else }}{{ .Content }}{{ end }}
</div>
{{- end }}

{{- $pages := union .RegularPages .Sections }}

{{- if .IsHome }}
{{- $pages = where site.RegularPages "Type" "in" site.Params.mainSections }}
{{- $pages = where $pages "Params.hiddenInHomeList" "!=" "true" }}
{{- end }}

{{- $paginator := .Paginate $pages }}

{{- if and .IsHome site.Params.homeInfoParams (eq $paginator.PageNumber 1) }}
<div class="hero-section">
  <h1>{{ site.Params.homeInfoParams.Title }}</h1>
  <p>{{ site.Params.homeInfoParams.Content }}</p>
</div>
{{- end }}

{{- if $paginator.Pages }}
<div class="posts-grid">
  {{- range $paginator.Pages }}
  <article class="post-card">
    <div class="post-card-content">
      <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
      <p>{{ .Summary }}</p>
      <div class="post-meta">
        <span>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1H2z"/>
            <path d="M14 5H2v9a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V5z"/>
          </svg>
          {{ .Date.Format "January 2, 2006" }}
        </span>
        <span>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 4.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3a.5.5 0 0 1 1 0z"/>
          </svg>
          {{ .ReadingTime }} min read
        </span>
        {{- if .Params.tags }}
        <span>{{ len .Params.tags }} tags</span>
        {{- end }}
      </div>
    </div>
  </article>
  {{- end }}
</div>
{{- end }}

{{- if gt $paginator.TotalPages 1 }}
<nav class="pagination">
  {{- if $paginator.HasPrev }}
  <a href="{{ $paginator.Prev.URL }}" class="btn">← Previous</a>
  {{- end }}
  {{- if $paginator.HasNext }}
  <a href="{{ $paginator.Next.URL }}" class="btn">Next →</a>
  {{- end }}
</nav>
{{- end }}

{{- end }}
{{- end }}
