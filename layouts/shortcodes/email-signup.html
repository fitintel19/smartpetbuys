{{- $type := .Get "type" | default "sidebar" -}}
{{- $offer := .Get "offer" | default "guide" -}}

{{- if eq $type "sidebar" -}}
<!-- Sidebar Email Signup -->
<div class="email-signup sidebar-signup" role="complementary" aria-labelledby="sidebar-signup-heading">
  <h3 id="sidebar-signup-heading">üêæ Get Our Free Pet Buying Guide!</h3>
  <p>Make smarter choices for your furry friend with our comprehensive buying guide.</p>
  
  <!-- MailerLite Form Embed -->
  <div class="ml-embedded" data-form="oq6Sfh"></div>
  
  <p class="privacy-note" role="note">
    <small>We respect your privacy. Unsubscribe anytime.</small>
  </p>
</div>

{{- else if eq $type "inline" -}}
<!-- Inline Content Email Signup -->
<div class="email-signup inline-signup" role="region" aria-labelledby="inline-signup-heading">
  <div class="signup-content">
    <h3 id="inline-signup-heading">üìß Love these pet product tips?</h3>
    <p>Get our <strong>FREE Ultimate Pet Buying Guide</strong> plus weekly product recommendations sent to your inbox!</p>
    
    <!-- MailerLite Form Embed -->
    <div class="ml-embedded" data-form="oq6Sfh"></div>
    
    <p class="benefits">
      ‚úÖ Expert product reviews &nbsp;&nbsp; ‚úÖ Money-saving deals &nbsp;&nbsp; ‚úÖ Safety alerts
    </p>
  </div>
</div>

{{- else if eq $type "exit-intent" -}}
<!-- Exit Intent Popup -->
<div id="exit-intent-popup" class="email-popup" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="popup-heading" aria-describedby="popup-description">
  <div class="popup-overlay" aria-hidden="true"></div>
  <div class="popup-content">
    <button class="popup-close" aria-label="Close popup">&times;</button>
    <div class="popup-body">
      <h2 id="popup-heading">Wait! Don't Leave Empty-Handed üêæ</h2>
      <p id="popup-description">Get our <strong>FREE Ultimate Pet Buying Guide</strong> before you go!</p>
      
      <ul class="popup-benefits" role="list">
        <li role="listitem">‚úÖ Save money on pet products</li>
        <li role="listitem">‚úÖ Avoid dangerous products</li>
        <li role="listitem">‚úÖ Find the best deals</li>
        <li role="listitem">‚úÖ Expert buying advice</li>
      </ul>
      
      <!-- MailerLite Form Embed -->
      <div class="ml-embedded" data-form="oq6Sfh"></div>
      
      <p class="popup-privacy" role="note">
        <small>We respect your privacy. No spam, unsubscribe anytime.</small>
      </p>
    </div>
  </div>
</div>

{{- else if eq $type "footer" -}}
<!-- Footer Newsletter Signup -->
<div class="email-signup footer-signup" role="complementary" aria-labelledby="footer-signup-heading">
  <h4 id="footer-signup-heading">üì¨ Smart Pet Parent Newsletter</h4>
  <p>Weekly product reviews, deals, and pet care tips</p>
  
  <!-- MailerLite Form Embed -->
  <div class="ml-embedded" data-form="oq6Sfh"></div>
</div>

{{- end -}}

<style>
/* Email Signup Styles */
.email-signup {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 8px;
  padding: 20px;
  margin: 20px 0;
  text-align: center;
}

.sidebar-signup {
  position: sticky;
  top: 20px;
  margin-bottom: 30px;
}

.inline-signup {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  margin: 30px 0;
}

.inline-signup h3 {
  color: white;
  margin-bottom: 10px;
}

.form-group, .form-row {
  margin-bottom: 15px;
}

.form-row {
  display: flex;
  gap: 10px;
}

.email-input {
  flex: 1;
  padding: 12px 15px;
  border: 1px solid #ddd;
  border-radius: 5px;
  font-size: 16px;
  width: 100%;
}

.email-input:focus {
  outline: none;
  border-color: #FF7F32;
  box-shadow: 0 0 0 3px rgba(255, 127, 50, 0.1);
}

.signup-btn {
  background: #FF7F32;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 5px;
  font-weight: 600;
  cursor: pointer;
  font-size: 16px;
  transition: background 0.3s ease;
}

.signup-btn:hover {
  background: #e66a2b;
}

.signup-btn.large {
  padding: 15px 30px;
  font-size: 18px;
  width: 100%;
}

.signup-btn.compact {
  padding: 10px 16px;
  font-size: 14px;
}

.privacy-note, .popup-privacy {
  margin-top: 10px;
  color: #666;
}

.benefits {
  font-size: 14px;
  margin-top: 15px;
  color: rgba(255, 255, 255, 0.9);
}

.popup-benefits {
  text-align: left;
  list-style: none;
  padding: 0;
  margin: 20px 0;
}

.popup-benefits li {
  padding: 5px 0;
  font-size: 16px;
}

/* Exit Intent Popup */
.email-popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9999;
}

.popup-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
}

.popup-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  border-radius: 10px;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
}

.popup-close {
  position: absolute;
  top: 15px;
  right: 20px;
  font-size: 30px;
  cursor: pointer;
  color: #666;
}

.popup-body {
  padding: 40px 30px 30px;
  text-align: center;
}

/* Footer Signup */
.footer-signup {
  background: transparent;
  border: none;
  padding: 0;
  color: inherit;
}

.footer-form .form-row {
  max-width: 400px;
  margin: 0 auto;
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .form-row {
    flex-direction: column;
  }
  
  .popup-content {
    width: 95%;
    margin: 20px;
  }
  
  .popup-body {
    padding: 30px 20px 20px;
  }
}
</style>

{{- if eq $type "exit-intent" -}}
<script>
// Exit Intent Popup Logic
let exitIntentShown = false;

function showExitIntentPopup() {
  if (!exitIntentShown && !localStorage.getItem('exitIntentShown')) {
    document.getElementById('exit-intent-popup').style.display = 'block';
    exitIntentShown = true;
    localStorage.setItem('exitIntentShown', 'true');
  }
}

// Show popup when mouse leaves viewport
document.addEventListener('mouseleave', function(e) {
  if (e.clientY <= 0) {
    showExitIntentPopup();
  }
});

// Close popup functionality
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('popup-close') || e.target.classList.contains('popup-overlay')) {
    document.getElementById('exit-intent-popup').style.display = 'none';
  }
});

// Show popup after 30 seconds as backup
setTimeout(function() {
  if (!exitIntentShown) {
    showExitIntentPopup();
  }
}, 30000);
</script>
{{- end -}}