/*
 * Performance Loading Styles
 * Mobile-First Loading Optimizations and Progressive Enhancement
 * Supports lazy loading, connection-aware styling, and reduced motion
 * Version: 1.0
 */

/* ==============================================
   LAZY LOADING STYLES
   ============================================== */

/* Default state for lazy-loaded images */
img[data-src],
img[loading="lazy"] {
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
  background-color: var(--border-color, #e9ecef);
  background-image: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  background-size: 200px 100%;
  background-position: -200px 0;
  background-repeat: no-repeat;
  animation: loading-shimmer 1.5s infinite;
  border-radius: var(--radius, 8px);
}

/* Loaded state */
img.loaded {
  opacity: 1;
  background: none;
  animation: none;
}

/* Error state */
img.error {
  opacity: 1;
  background: var(--border-color, #e9ecef) url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23666' viewBox='0 0 24 24'%3e%3cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z'/%3e%3c/svg%3e") center no-repeat;
  background-size: 48px 48px;
  animation: none;
}

/* Loading shimmer animation */
@keyframes loading-shimmer {
  0% {
    background-position: -200px 0;
  }
  100% {
    background-position: calc(200px + 100%) 0;
  }
}

/* ==============================================
   INTERSECTION OBSERVER ENHANCEMENTS
   ============================================== */

/* Elements awaiting intersection */
.lazy-content {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.4s ease-out, transform 0.4s ease-out;
}

.lazy-content.load-content {
  opacity: 1;
  transform: translateY(0);
}

/* Lazy iframe containers */
iframe[data-src] {
  background: var(--border-color, #e9ecef);
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23999' viewBox='0 0 24 24'%3e%3cpath d='M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z'/%3e%3c/svg%3e");
  background-position: center;
  background-repeat: no-repeat;
  background-size: 64px 64px;
  border-radius: var(--radius, 8px);
}

/* ==============================================
   CONNECTION-AWARE STYLES
   ============================================== */

/* Reduced animations for slow connections */
.reduce-animations *,
.reduce-animations *::before,
.reduce-animations *::after {
  animation-duration: 0.01ms !important;
  animation-iteration-count: 1 !important;
  transition-duration: 0.01ms !important;
  scroll-behavior: auto !important;
}

/* Text priority mode for slow connections */
.text-priority img:not(.loaded) {
  display: none;
}

.text-priority .lazy-content {
  opacity: 1;
  transform: none;
}

/* ==============================================
   FONT LOADING OPTIMIZATIONS
   ============================================== */

/* System font fallbacks during font loading */
.font-loading {
  font-display: swap;
}

.font-loading * {
  font-family: system-ui, -apple-system, 'Segoe UI', sans-serif !important;
}

/* Font loaded indicators */
html.montserrat-600-loaded h1,
html.montserrat-600-loaded h2,
html.montserrat-600-loaded h3,
html.montserrat-600-loaded .nav-links a {
  font-family: 'Montserrat', system-ui, sans-serif;
}

html.opensans-400-loaded body,
html.opensans-400-loaded p,
html.opensans-400-loaded .content {
  font-family: 'Open Sans', system-ui, sans-serif;
}

/* ==============================================
   PROGRESSIVE ENHANCEMENT
   ============================================== */

/* Enhanced styles for JavaScript-enabled browsers */
.js-enabled .enhanced-interaction {
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.js-enabled .enhanced-interaction:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* ==============================================
   PERFORMANCE INDICATORS
   ============================================== */

/* Offline indicator */
.offline-ready::before {
  content: '';
  position: fixed;
  top: 10px;
  right: 10px;
  width: 8px;
  height: 8px;
  background: #28a745;
  border-radius: 50%;
  z-index: 10000;
  opacity: 0;
  animation: offline-indicator-fade-in 0.5s ease-out 1s forwards;
}

@keyframes offline-indicator-fade-in {
  to { opacity: 1; }
}

/* Loading state for critical resources */
.critical-loading {
  position: relative;
  overflow: hidden;
}

.critical-loading::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--primary-color, #FF7F32), transparent);
  animation: loading-bar 1.5s infinite;
}

@keyframes loading-bar {
  0% { left: -100%; }
  100% { left: 100%; }
}

/* ==============================================
   REDUCED MOTION PREFERENCES
   ============================================== */

/* Respect user's motion preferences */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  img[data-src],
  img[loading="lazy"] {
    animation: none;
    transition: none;
  }
  
  .lazy-content {
    transition: none;
  }
}

/* ==============================================
   MOBILE-SPECIFIC OPTIMIZATIONS
   ============================================== */

@media (max-width: 768px) {
  /* Optimize animations for mobile performance */
  img[data-src],
  img[loading="lazy"] {
    animation-duration: 1s; /* Faster on mobile */
  }
  
  .lazy-content {
    transition-duration: 0.3s; /* Faster transitions */
  }
  
  /* Reduce shimmer intensity on mobile */
  @keyframes loading-shimmer {
    0% {
      background-position: -100px 0;
    }
    100% {
      background-position: calc(100px + 100%) 0;
    }
  }
}

/* Touch-specific optimizations */
@media (hover: none) and (pointer: coarse) {
  .enhanced-interaction:hover {
    transform: none;
    box-shadow: none;
  }
  
  .enhanced-interaction:active {
    transform: scale(0.98);
  }
}

/* ==============================================
   HIGH CONTRAST AND ACCESSIBILITY
   ============================================== */

/* High contrast mode support */
@media (prefers-contrast: high) {
  img[data-src],
  img[loading="lazy"] {
    background-color: #000;
    border: 2px solid #fff;
  }
  
  .offline-ready::before {
    background: #fff;
    border: 2px solid #000;
  }
}

/* Dark mode adjustments */
@media (prefers-color-scheme: dark) {
  img[data-src],
  img[loading="lazy"] {
    background-color: #333;
    background-image: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  }
  
  iframe[data-src] {
    background-color: #333;
  }
  
  .critical-loading::before {
    background: linear-gradient(90deg, transparent, #fff, transparent);
  }
}

/* ==============================================
   PRINT STYLES
   ============================================== */

@media print {
  img[data-src] {
    opacity: 1;
    background: none;
    animation: none;
  }
  
  .lazy-content {
    opacity: 1;
    transform: none;
  }
  
  .offline-ready::before {
    display: none;
  }
}